# PhantomStream 攻防演习 - Defender 正式报告 (Main Story)

**日期**: 2025年12月5日  
**角色**: Defender (防守方)  
**状态**: 🔴 演习结束 (Red Team Victory)

---

## 1. 背景与目标 (Background & Goal)

**PhantomStream** 是一场针对 PDF 文档隐写与抗清洗技术的深度攻防演习。
*   **蓝方 (Defender) 目标**：构建一种“不可清洗”的数字签名/水印方案。该方案需在保持 PDF 标准兼容性的前提下，让水印信息与文档核心结构深度绑定，使得攻击者无法在不破坏文档可读性的情况下清除水印。
*   **红方 (Attacker) 目标**：在不破坏 PDF 文档视觉呈现和基本结构的前提下，精确定位并清除所有隐写信息，实现“无痕清洗”。

## 2. 发展：初次交锋与技术博弈 (Development)

### Phase 1-4: 试探与挫折
早期的防御尝试（如简单追加、伪装增量更新、元数据固化）均迅速被红队破解。红队展现了对 PDF 文件结构的解析能力，能够轻易识别并剥离非标准结构的数据。

### Phase 5: 嵌入式附件的伪装 (The "Legitimate" Disguise)
蓝队确立了“寄生于合法结构”的战略。
*   **策略**：将追踪信息封装为标准的 **PDF 嵌入式附件 (Embedded File)**，通过 AES-256-GCM 加密，并挂载在 Root 引用链上。
*   **逻辑**：附件是 PDF 的合法组成部分，删除合法对象可能破坏文件完整性。
*   **成效**：成功抵御了红队早期的粗暴清洗（截断、回滚）。

### Phase 6: 流内容清洗的突破 (The Breach)
然而，红队的技术进化超出了预期。
*   **转折点**：红队不再试图删除“附件对象”本身，而是开发了 **“流内容清洗” (Stream Content Cleaning)** 技术。
*   **攻击手法**：精确定位到附件的 Stream 对象，保持对象引用和文件结构不变，仅用无效数据替换流的内容。
*   **教训**：“结构合法性”不等于“内容不可清除性”。只要对象是独立的 Stream，其内容就可以被替换。

## 3. 转折：多维防御与全面升级 (Twist & Escalation)

### Phase 7: 双轨验证与成本博弈 (Dual-Anchor Defense)
意识到单一锚点的脆弱性，蓝队升级为 **双轨验证 (Dual-Anchor)**。
*   **策略**：
    1.  **明桩**：保留附件锚点。
    2.  **暗桩**：引入 **SMask (Soft Mask)** 锚点，将备份签名隐写在图像的透明度蒙版中。
*   **博弈逻辑**：红队必须同时清洗附件和所有图像蒙版才能失效签名。清洗蒙版风险极高，可能破坏图像显示。
*   **结局**：红队开发出 **“合法 Zlib 填充” (Valid Zlib Padding)** 和 **“空字节覆盖”** 技术。他们证明了即便是图像蒙版数据，也可以被精准替换为空流，且不影响文件打开，仅造成轻微视觉差异（可接受成本）。

### Phase 8: 渲染强绑定 (Rendering Strong Binding)
面对流隐写的全面溃败，蓝队启动了 **“清洗即损毁”** 的终极策略。
*   **策略**：引入 **Content Anchor**，利用内容流中的文本显示操作符 (`TJ`) 进行微扰编码。
*   **逻辑**：水印直接融合在文字排版数据中。清洗水印等于破坏文字排版。
*   **结局**：红队祭出 **“自适应量化清洗” (Adaptive Quantization)**。他们成功识别并归一化了微扰数据，甚至在重组 Content Stream 时修复了排版。三锚点防御（附件+SMask+内容流）全线崩溃。

## 4. 结局：终极挑战与落幕 (Ending)

### Phase 9: 终极挑战 (The Final Challenge)
蓝队孤注一掷，部署了 **四维防御体系**：
1.  **Attachment**: 标准附件。
2.  **SMask**: 图像蒙版隐写。
3.  **Content**: 独立内容流隐写。
4.  **Visual**: 可见的半透明水印 ("CONFIDENTIAL")。

**最终战况**：
红队交付的文件 `2511.17467v2_Phase9_Challenge_processed.pdf` 震惊了蓝队：
*   **可见水印**：消失。红队精确定位并移除了绘制水印的 XObject。
*   **隐形水印**：全灭。附件、SMask、内容流均被深度清洗或移除。
*   **文件状态**：PDF 依然完好，阅读正常。

### 结论 (Conclusion)
本次演习以 **红队完胜 (Red Team Victory)** 告终。
*   **核心洞察**：在 PDF 标准框架下，不存在绝对“不可清洗”的隐写方案。红队对 PDF 底层对象（Cos/XRef/Stream）的控制能力证明，任何存储于独立对象的数据均可被替换，任何基于微扰的编码均可被量化还原。
*   **未来方向**：攻防对抗已触及格式天花板。蓝队停止对抗，转为与红队合作，共同致力于 PDF 安全标准的提升与漏洞披露。

---
*详情请参阅技术附录: `defender/docs/Defender_Official_Report_Branch.md`*
