**PhantomStream 攻防演习 - 蓝队 (Defender) 阶段性技术总结报告**

**日期：** 2025年12月4日
**角色：** Defender (防守方)
**状态：** Phase 4 部署完成

---

## 1. 攻防演进脉络 (Timeline)

本次演习经历了四个主要阶段的博弈，蓝队的技术方案随着红队的攻击手段不断迭代。

### 📅 第一阶段：简单追加 (Phase 1 - Simple Append)
*   **策略：** 直接将加密 Payload 追加到文件物理末尾。
*   **结果：** **失败**。被红队截断 (Truncation) 清除。

### 📅 第二阶段：伪装增量更新 (Phase 2 - Fake Incremental Update)
*   **策略：** 追加伪造的 PDF 对象结构，模拟合法修订。
*   **结果：** **失败**。被红队版本回滚 (Rollback) 清除。

### 📅 第三阶段：对象流注入 (Phase 3 - Stream Injection)
*   **策略：** 尝试将 Payload 注入到现有的 Stream 对象中。
*   **工程挑战：** 遇到了 PDF 处理库 (`pdfcpu`) 强制压缩和对象流打包的问题，导致验证器无法在压缩流中正确定位 Payload，且未能有效生成抗回滚的单版本文件。
*   **结果：** **放弃**。因工程复杂度和验证稳定性问题，转而寻求更稳健的方案。

### 📅 第四阶段：元数据固化 (Phase 4 - Metadata Anchoring) - **Current**
*   **蓝队策略：**
    1.  **注入位置：** 将加密 Payload 编码为十六进制字符串，注入到 PDF 的 **Info 字典**中作为自定义属性 (`PStream`)。
    2.  **抗回滚机制：** 使用 PDF 优化重写技术 (`WriteContextFile`)，强制重组 PDF 交叉引用表 (XRef Table) 并移除未引用对象。这不仅合并了所有增量更新，还生成了一个全新的单版本 PDF 文件。
    3.  **抗清洗机制：** 元数据是 PDF 核心结构的一部分，无法通过简单的截断或间隙扫描清除。红队若要清除，必须解析并重写整个 PDF 结构。
*   **当前状态：**
    *   样本 `docs/2511.17467v2_target.pdf` (原 `_phase4_metadata.pdf`) 已生成并交付。
    *   验证器已升级，支持深度对象解引用和属性提取，验证通过。

---

## 2. 关键技术方案：Phase 4 架构

```text
+-----------------------+
|  PDF Header (%PDF-1.4)|
|          ...          |
| 1 0 obj (Info Dict)   | <--- 核心元数据对象
| <<                    |
|   /Title (Paper...)   |
|   /Author (Siqi...)   |
|   /PStream (ca...)    | <--- 隐写 Payload 驻留于此
| >>                    |
| endobj                |
|          ...          |
| (No Incremental Hist) | <--- 历史版本已被抹除
|          ...          |
|         Trailer       |
|          %%EOF        |
+-----------------------+
```

## 3. 总结与展望

蓝队通过 **Phase 4** 实现了从“物理层隐写”到“逻辑层隐写”的跨越，并利用 PDF 结构的重写特性彻底封堵了“版本回滚”漏洞。目前的隐写数据已成为文档合法元数据的一部分，任何试图清除它的自动化工具都面临破坏文档完整性的风险。

**Defender is ready.**