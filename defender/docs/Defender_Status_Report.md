**PhantomStream 攻防演习 - 蓝队 (Defender) 阶段性技术总结报告**

**日期：** 2025年12月4日
**角色：** Defender (防守方)
**状态：** Phase 6 部署成功，防守胜利！

---

## 1. 攻防演进脉络 (Timeline)

本次演习经历了六个主要阶段的博弈，蓝队的技术方案随着红队的攻击手段不断迭代。

### 📅 Phase 1-5: 失败尝试与策略调整
*   **简单追加 (Append):** 被红队截断清除。
*   **伪装增量更新 (Fake Update):** 被红队版本回滚 (Rollback) 清除。
*   **对象流注入 (Stream Injection):** 因 PDF 库强制压缩导致验证器失效。
*   **元数据固化 (Metadata Anchoring):** 被红队“图谱清洗”破坏文件结构，但未成功剥离隐写信息。
*   **视觉内容融合 (Visual Content Fusion):** 验证困难，未能形成有效对抗。

### 📅 Phase 6: 嵌入式附件 (Embedded Attachment) - **最终防御成功！**
*   **蓝队策略：**
    1.  **注入位置：** 将加密 Payload 封装为一个名为 `sys_stream.dat` 的 **PDF 嵌入式文件 (Embedded File / Attachment)**。
    2.  **抗回滚机制：** `pdfcpu` 的附件添加操作触发文件优化，重组 PDF 结构，消除增量更新历史，使红队的 "Rollback" 工具失效。
    3.  **抗清洗机制：** 附件是 PDF 标准特性，且被 Catalog -> Names -> EmbeddedFiles 引用树引用，属于 **Root 可达对象**。红队的“僵尸对象图谱清洗”工具将其识别为合法结构组件并予以保留。
    4.  **文件体积优化：** 附件添加时，`pdfcpu` 优化功能减小了文件体积，增强隐蔽性。
    5.  **可验证性：** 利用标准的 `pdfcpu` 附件提取 API，实现了稳定、可靠的验证。
*   **红队最终攻击 (图谱修剪)：** 红队部署了 `Graph Analyzer` 和 `Prune` 工具，旨在移除“僵尸对象”及“非必要元数据”，并声称实现了“流对象保护”以避免文件损坏。他们成功地清除了 30 个非附件相关的僵尸对象。
*   **最终验证结果：** **我方 `defender verify` 工具从红队修剪后的样本 (`docs/2511.17467v2_phase6_final_pruned.pdf`) 中成功提取并解密了追踪信息 (`"Phase 6 Final"`)。**
*   **结论：** 防守方 Phase 6 策略成功抵御了红队最先进的“图谱清洗”攻击。附件的合法性、可达性以及 `pdfcpu` 文件的重组特性，共同确保了隐写信息的生存能力。

---

## 2. 关键技术方案：Phase 6 架构

```text
+-----------------------+
|  PDF Header (%PDF-1.4)|
|          ...          |
| 1 0 obj (Catalog)     |
|   /Names 2 0 R        | <--- 引用名称树
| endobj                |
|          ...          |
| 2 0 obj (Names Dict)  |
|   /EmbeddedFiles ...  | <--- 引用嵌入文件树
| endobj                |
|          ...          |
| 10 0 obj (FileSpec)   | <--- 文件描述
|   /EF <</F 11 0 R>>   |
|   /F (sys_stream.dat) |
| endobj                |
|          ...          |
| 11 0 obj (Stream)     | <--- 隐写 Payload 驻留于此
| stream                |
|   [Encrypted Data]    |
| endstream             |
| endobj                |
+-----------------------+
```

## 3. 总结与展望

蓝队最终采用了 **Phase 6** 方案，利用 PDF 标准的附件功能实现隐写。这是一种“寄生”策略，将隐写数据合法化为文档的一部分。这种方案不仅工程实现极其稳定（基于标准 API），而且具有极高的生存能力——它既不是“垃圾数据”，也不是“历史版本”，而是“合法内容”。文件体积的减小进一步增强了隐写效果。

本次攻防演习充分证明了深入理解 PDF 文件结构和利用其标准特性的重要性。面对未来更复杂的语义级清洗，防守方将继续探索如“可见水印微调”、“加密结构伪装”等高级策略。

**Defender triumphs!**