# PhantomStream 联合行动报告：PDF 主权之战

**日期**: 2025年12月5日  
**参与方**:
*   **防御方 (蓝队)**: PhantomStream 防御事业部
*   **攻击方 (红队)**: 特别行动组 (盲测单元)
**最终状态**: 🔴 红队完胜 (Phase 9 全面攻陷)

---

## 1. 执行摘要 (Executive Summary)

**PhantomStream** 是一场聚焦于 **PDF 隐写术与反取证技术** 的高强度攻防演习。本次演习在严格的 **盲测 (Blind Test)** 条件下进行——红队对蓝队的注入技术一无所知，仅能依靠对文件结构的深度分析来进行对抗。

在历经 9 个阶段的激烈博弈后，演习从最初的元数据篡改，演变为涉及加密、流注入和渲染层绑定的复杂多维对抗。

**最终结局**: 红队成功开发出一套“全谱系清洗 (Full-Spectrum Cleaning)”方法论，彻底瓦解了蓝队的所有防御机制——包括 Phase 9 的“终极挑战”。这证明了**在当前的 PDF 标准规范下，面对具备深度结构认知的高阶对手，想要构建“永不磨灭”的水印在技术上是不可行的。**

---

## 2. 战略信条 (Strategic Doctrines)

### 🛡️ 防御方战略：“合法性与绑定” (Legitimacy & Binding)
蓝队的核心哲学经历了从“隐藏”到“绑定”的蜕变：
1.  **寄生合法性 (Parasitic Legitimacy)**：将数据嵌入到 PDF 标准强制要求的合法对象（如附件、SMask）中，使删除操作面临破坏文件的风险。
2.  **多层冗余 (Multi-Layer Redundancy)**：使用多个独立的锚点（双轨/三轨/四轨），迫使攻击者陷入“打地鼠”的消耗战。
3.  **渲染强绑定 (Rendering Strong Binding)**：将数据编码进视觉渲染指令（如内容流的文字排版）中，贯彻“清洗即损毁”的威慑策略。

### ⚔️ 攻击方战略：“结构卫生” (Structural Hygiene)
红队始终贯彻极其严苛的“净化”原则：
1.  **结构卫生 (Structural Hygiene)**：任何非“视觉呈现所必须”的数据，均被视为“废料”并予以清除。
2.  **外科手术式清洗 (Surgical Cleaning)**：不再粗暴删除对象（这会破坏结构），而是用合法的空数据（如 Valid Zlib Padding）**替换**对象内容。
3.  **自适应量化 (Adaptive Quantization)**：降低非关键数据（如图像、间距）的精度，在保留视觉保真度的同时剥离隐写噪点。

---

## 3. 战役进程与关键转折 (Operational Timeline & Key Battles)

### 📅 前期博弈：结构与元数据 (Phase 1-5)
*   **防御方**: 尝试标准隐写手段（追加数据、伪装增量更新、元数据固化）。
*   **攻击方**: 祭出“图谱修剪 (Graph-based Pruning)”和“版本回滚”。
*   **战况**: **红队完胜**。红队证明了任何非标准的结构外挂数据都是极易被检测的。
*   **转折**: 蓝队转向 **Phase 5 (嵌入式附件)**，利用 PDF 标准附件功能模拟合法文件结构，一度迟滞了红队的攻势。

### 📅 中期博弈：流的战争 (Phase 6-7)
*   **突破口 (Phase 6)**: 红队开发出 **“流内容清洗 (Stream Content Cleaning)”** 技术。他们停止了“删除”对象，转而开始“掏空”对象。
*   **防御升级 (Phase 7)**: 蓝队部署 **双轨防御 (Dual-Anchor)**（附件 + SMask）。SMask（软蒙版）锚点将数据藏匿于图像透明通道中，赌红队不敢清洗以免破坏图像。
*   **攻击反制**: 红队开发出 **“合法 Zlib 填充”** 和 **“空字节覆盖”**。
    *   *突破点*: 红队证明，即便是图像蒙版，也可以被替换为空流而不破坏文件结构，仅造成微乎其微的视觉差异。
*   **战况**: **红队完胜**。双轨防御被精准的流替换技术击穿。

### 📅 后期博弈：渲染的前沿 (Phase 8)
*   **防御升级**: 蓝队部署 **“渲染强绑定” (三轨锚点)**。
    *   新增 **内容锚点 (Content Anchor)**：将数据编码进文本的字间距（`TJ` 操作符）中。
    *   *理论*: 清洗该水印将导致文字排版错乱。
*   **攻击反制**: 红队开发出 **“自适应量化”**。
    *   *突破点*: 分析文本流并对间距数值进行“归一化 (Normalization)”。文字依然可读，但隐藏的微扰信息（水印）被抹平。
*   **战况**: **红队完胜**。由于 PDF 渲染引擎的容错性和红队量化算法的鲁棒性，“清洗即损毁”理论宣告破产。

---

## 4. 终局之战：Phase 9 终极挑战

为了测试防御的极限，蓝队在 Phase 9 实施了“孤注一掷”的策略。

**防御配置 (四轨锚点)**：
1.  **附件锚点**: 加密载荷藏于 `EmbeddedFiles` (Obj 72)。
2.  **SMask 锚点**: 加密载荷藏于图像透明蒙版 (Obj 76, 59, 60)。
3.  **内容锚点**: 注入独立的隐形内容流参与页面渲染。
4.  **视觉锚点**: 一个肉眼可见的半透明水印 "CONFIDENTIAL" (Obj 82)。

**攻击执行**：
红队执行了 **“全流扫描 + 外科手术式清洗”** 行动：
1.  **视觉与附件**: 使用 **合法 Zlib 填充** 彻底抹除。可见水印凭空消失；附件变成了 0 字节的空壳。
2.  **SMask**: 使用 **自适应量化** 清洗。高熵噪声（加密数据）被平滑处理，载荷被破坏但图像依然有效。
3.  **内容流**: 独立的隐形流被识别为“非必要结构”，并被直接移除或断开链接。

**战果核验**：
*   **可见水印**: 消失。
*   **隐写载荷**: 所有提取尝试均失败（0 字节或校验错误）。
*   **文档完整性**: 完美。文件在所有阅读器中均无报错打开。

---

## 5. 技术结论 (Technical Conclusions)

### 5.1 “容器谬误” (The Container Fallacy)
防御方最大的败笔在于过度依赖 PDF 对象容器（Stream）来保护数据。演习证明，**在 PDF 中，容器与内容是可分离的**。攻击者可以在保留容器（维持结构合法性）的同时，用“卫生”的空数据替换内容。

### 5.2 隐写术的边界
PhantomStream 证明，**面对“格式感知 (Format-Aware)”的对手，盲隐写是不可能的**。如果对手比防御者更懂文件格式，他们就能轻易区分“信号”（视觉内容）与“噪声”（隐写数据），并精准过滤掉噪声。

### 5.3 对数字版权管理 (DRM) 的启示
对于版权保护而言：
*   **被动水印是不足的**：任何被动的隐藏数据最终都能被清洗。
*   **必须转向主动防御**：未来的保护机制必须走出文件格式本身（例如：在线令牌验证、区块链存证、或专用阅读器封装）。

---

## 6. 致谢

本报告汇总了以下文档的战果与发现：
*   `defender/docs/Defender_Official_Report_Main.md` (蓝队战略与叙事)
*   `attacker/PHANTOMSTREAM_FINAL_REPORT.md` (红队技术执行)

**签署，**
*PhantomStream 联合工作组*
